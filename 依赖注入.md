# 依赖注入

## 控制反转 `IoC`

asp.net core应用在启动以及后续正对请求的处理过程中会依赖各种组件提供服务。为了便于定制，这些组件会以接口的形式进行标准化，我们将这些标准化的组件统一称为“**服务**” (service)。

整个asp.net core框架建立在一个底层的依赖注入上，使用**依赖注入容器**提供所需的服务对象。

控制反转体现的是控制权的转移。控制权原来在a手中，现在需要b来接管。任何一个任务的实施都有固有的流程，而`IoC`涉及的控制可以理解为“正对流程的控制”

`IoC`是设计框架所采用的一种基本思想，**所谓的控制反转就是将应用对流程的控制转移到框架之**。

> 好莱坞法则
>
> 演员把简历递交给电影公司只能回家等待消息，公司整个娱乐项目有完全的控制权，演员只能被动的接受电影公司的邀请。`IoC`完美的体现这个法则

在`IoC `的语境中。框架就是电影制片流程的电影公司，这个流程的掌控者，知道那个环节需要那些人。应用程序就像是演员，只需要按照框架的规则注册这些组件，框架会在适当的时候自动加载并执行注册过的组件。

一方面通过流程控制从应用程序向框架的转移，实现了针对流程的重用，另一个方面通过内置的扩展机制使得这个被重用的流程能够自由的被定制。

几个具体的体现：

1. 模板方法

   ```
   将一个服用的工作流程或者多个步骤定义成模板方法，单一步骤在虚方法中实现。
   可以通过派生类重写想要的虚方法来实现
   ```

2. 工厂方法
3. 抽象工厂
4. 依赖注入

## 依赖注入

在应用启动时，框架会对所需要的服务进行全局注册。服务大多是支队实现的接口或者继承的抽象类进行注册。

按照好莱坞法则，应用只需要定义并注册好所需要的服务，服务实例的提供则完全交给框架来完成，框架使用一个独立的容器：依赖注入容器来提供每一个服务实例。

服务消费者只需要告诉容器所需要服务的类型，就能得到与之匹配的服务实例。

### 三种依赖注入的方式

提供依赖服务对象可能具有对其他服务对象的依赖。作为服务对象的提供者依赖注入容器会根据依赖链提供所有的依赖服务实例。

#### 构造函数注入 最理想

#### 属性注入

#### 方法注入

### 服务定位模式 Service Locator 模式

和依赖注入的主要差别

- service locator是应用程序在利用他来提供所需要的服务实例，所以使用者是应用程序

- 依赖服务是注入的方式来提供，是将服务推送到依赖注入的容器。而service locator是利用service locator拉去所需要的服务。

  

