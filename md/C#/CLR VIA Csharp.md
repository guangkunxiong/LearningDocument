## 引用类型和值类型

首先需要清楚的事情

1. 内存必须从托管堆中分配
2. 堆上分配的每一个对象都有额外的一些成员这些成员必须初始化
3. 对象中的其他字节（为字段而设）总是设为零
4. 从托管堆中分配对象时，可能强制执行一次垃圾回收

在查看文档类型时任何称之为“类”类型都是引用类型。所有值类型都称之为结构或者枚举。

进一步查看文档，结构都是抽象类型System.ValueType的直接派生类。System.ValueType派生于System.Object。所有枚举都从 System.Enum派生。

所有值类型都是隐式密封，目的是为了防止将值类型作为其他引用类型或这类型的基类型。

是否定义为值类型应该满足一下条件

- 类型具有基元类型的行为。十分简单的类型，没有成员会修改类型的任何实例字段。值类型建议是只读的
- 类型不继承和派生任何类
- 类型实例的大小应该小于16字节。因为实参默认以传值的方式传递参数，造成对值类型在实例中的字段进行复制。
- 类型的实例较大的不应该作为方法的实参进行传递和返回

#### 装箱和拆箱

装箱时发生的事情

1. 在托管堆中分配内存。当然包括托管堆对象都有的类型对象指针和同步索引块
2. 值类型的字段复制到新分配的堆内存
3. 返回对象地址。

拆箱的时候发生的事情

1. 如果已经装箱的引用的变量为null，那么会抛出NullReferenceException异常
2. 如果引用的对象不是所需值类型的已经装箱实例会抛出InvalidCastException异常





